# Analysis and Recommendation Methodology

This document outlines the methodologies used in the ASX Trading Analysis and Recommendation System.

## 1. Data Acquisition

*   **Source:** Historical stock prices (Open, High, Low, Close, Volume - OHLCV) and company fundamental information are sourced from Yahoo Finance using the `yfinance` Python library.
*   **ASX Tickers:** Tickers must end with `.AX` (e.g., `CBA.AX`).
*   **Frequency:** Users can select either daily (`1d`) or weekly (`1wk`) data intervals.
*   **Time Window:** Data can be fetched for a user-specified period (e.g., "1y", "5y", specific start/end dates), up to a maximum of 5 years from the current date as per project constraints. `yfinance` itself might have different "max" periods.
*   **Company Information:** Key financial metrics and company profile data (e.g., 'marketCap', 'trailingPE', 'forwardPE', 'dividendYield', 'sector', 'longBusinessSummary', 'exchange', 'currency', 'shortName') are fetched from `yfinance`'s `.info` attribute.

## 2. Data Cleansing (`data_cleanser.py`)

*   **Loading:** Price data is loaded from CSV files generated by the crawler.
*   **DateTime Conversion:** The 'Date' column is converted to `pandas.datetime` objects.
*   **Sorting:** Data is sorted by date chronologically.
*   **Missing Values (NaNs):**
    *   For OHLC columns ('Open', 'High', 'Low', 'Close'), missing values are forward-filled (`ffill`).
    *   For the 'Volume' column, missing values are first forward-filled, and any remaining NaNs (e.g., at the beginning) are filled with 0.
    *   Rows where critical OHLC values remain NaN after ffill (typically only if NaNs are at the very start of the series) are dropped.
*   **Numeric Types:** OHLCV columns are explicitly converted to numeric types.
*   **Duplicate Dates:** Rows with duplicate dates are removed, keeping the first occurrence.
*   **Adjusted Prices:** The `yfinance` library is called with `auto_adjust=True` during data crawling, meaning historical prices are automatically adjusted for dividends and stock splits. The cleansing module assumes this pre-adjusted data.
*   **Output:** A cleansed DataFrame is produced, and a report detailing the cleansing steps is generated.

## 3. Technical Analysis Indicators (`analysis_engine.py`)

The following technical indicators are calculated on the cleansed 'Close' price:

*   **Simple Moving Averages (SMAs):**
    *   **Calculation:** Standard SMAs are calculated for user-defined short-term and long-term windows.
    *   **Default Windows:**
        *   Daily data: Short = 50 periods, Long = 200 periods.
        *   Weekly data: Short = 10 periods, Long = 40 periods.
    *   **Purpose:** Identify trends and potential support/resistance levels. Crossovers and price position relative to SMAs are used in recommendation logic.
*   **Relative Strength Index (RSI):**
    *   **Calculation:** A standard 14-period RSI is calculated by default, but the window is user-configurable.
    *   **Purpose:** A momentum oscillator measuring the speed and change of price movements.
    *   **Interpretation in Recommendation:**
        *   RSI > 70: Considered overbought (cautionary for new BUY signals).
        *   RSI < 30: Considered oversold (potential opportunity).
        *   RSI > 50: Generally indicates positive momentum.
        *   RSI < 50: Generally indicates negative momentum.

## 4. Forecasting (30-Day Holding Period) (`analysis_engine.py`)

A simple heuristic forecast is generated to estimate the price approximately 30 calendar days into the future, considering the mandatory holding period.

*   **Method:** Momentum-based.
    *   Calculates the average price change per period (daily or weekly based on interval) over a recent lookback window. The lookback window is set to twice the forecast horizon (e.g., for a 30-day daily forecast of ~21 trading days, lookback is ~42 trading days).
    *   Projects the last close price forward by this average change multiplied by the number of trading periods in ~30 calendar days (21 for daily, 4 for weekly).
*   **Fallback:** If data is insufficient for the primary momentum calculation, it attempts to use the single last period's change. If that also fails, no forecast is made.
*   **Expected Return:** Calculated as `((Forecasted Price - Last Close Price) / Last Close Price) * 100%`.
*   **Limitations:** This is a very basic linear extrapolation and does not account for market volatility, news events, or non-linear price dynamics. It serves as one of several inputs to the recommendation.

## 5. Backtesting (`backtester.py`)

*   **Objective:** To evaluate the historical performance of a defined trading strategy incorporating the 30-calendar-day mandatory holding period.
*   **Default Strategy (`simple_sma_rsi_strategy`):**
    *   **Entry (BUY):**
        *   Short-term SMA > Long-term SMA.
        *   RSI < 70 (not overbought).
        *   (Implicitly, must not currently be holding the stock).
    *   **Exit Signal (SELL_SIGNAL):**
        *   (Only if currently holding stock).
        *   Short-term SMA < Long-term SMA OR RSI > 80 (very overbought, more aggressive sell signal).
*   **Execution Logic:**
    1.  Iterates through historical data.
    2.  If a BUY signal occurs and not holding, a purchase is simulated using all available capital.
    3.  The position is held for a minimum of 30 calendar days.
    4.  After the 30-day period, if a SELL_SIGNAL from the strategy occurs, the position is sold.
    5.  If the backtest period ends while still holding a position, it's valued at the last available price for final portfolio calculation.
*   **Metrics Calculated:**
    *   Initial and Final Portfolio Value.
    *   Total Return (Absolute and Percentage).
    *   Number of Trades (completed round trips).
    *   Number of Profitable Trades.
    *   Win Rate (Percentage).
    *   Average Gain Percentage (for profitable trades).
    *   Average Loss Percentage (for losing trades).

## 6. Recommendation Logic (`recommender.py`)

The final recommendation (BUY, HOLD, SELL) and confidence level (High, Medium, Low) are determined by a rule-based system that weighs signals from SMAs, RSI, the 30-day forecast, and optionally, overall backtest performance.

*   **Signal Aggregation:**
    *   **SMA:** Bullish if price is above short SMA, and short SMA is above long SMA. Bearish if price is below short SMA, and short SMA is below long SMA. Otherwise neutral.
    *   **RSI:** Bullish if <30 (oversold) or (50 < RSI <= 70, positive momentum). Bearish if >70 (overbought for new buys) or (30 <= RSI < 50, negative momentum).
    *   **Forecast:** Bullish if expected 30-day return > 5%. Bearish if < -5%. Otherwise neutral.
    *   **Backtest (Optional):** A small bullish weight if overall backtest return > 10% and win rate > 50%. A small bearish weight if return < -5%.
*   **Decision Rules:**
    *   **BUY:** Awarded if bullish signals significantly outweigh bearish signals.
    *   **SELL:** Awarded if bearish signals significantly outweigh bullish signals (primarily as an indicator to avoid buying or if one hypothetically holds the stock).
    *   **HOLD:** Default if signals are mixed or neutral.
*   **Confidence Level:**
    *   **High:** Strong agreement among multiple bullish/bearish indicators.
    *   **Medium:** Some alignment, but not all signals are strong or in perfect agreement.
    *   **Low:** Mixed, weak, or contradictory signals.
*   **Output:** The recommendation, confidence, and a list of reasoning points contributing to the decision are provided.

## Disclaimer

The methodologies described are based on common technical analysis techniques and simplified forecasting models. They do not guarantee future performance. Financial markets are complex and subject to various unpredictable factors. This system is intended for educational and informational purposes and should not be considered financial advice. Always conduct your own research and consult with a qualified financial advisor before making investment decisions.
